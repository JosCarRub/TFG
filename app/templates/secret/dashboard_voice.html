{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Voice Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{% static 'css/secret_voice.css' %}" rel="stylesheet">
</head>
<body>
    <!-- Background Canvas -->
    <canvas id="backgroundCanvas"></canvas>
    
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-content">
            <!-- Brand -->
            <div class="brand">
                <div class="brand-icon">
                    <i class="fas fa-microphone"></i>
                </div>
                <div class="brand-text">
                    <div class="brand-title">Voice AI</div>
                    <div class="brand-subtitle">Assistant</div>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="nav-menu">
                <a href="{% url 'home' %}" class="nav-item active">
                    <i class="fas fa-arrow-left nav-icon"></i>
                    <span>Volver a la aplicacion</span>
                </a>
                <a href="{% url 'dashboard' %}" class="nav-item">
                    <i class="fas fa-keyboard"></i>
                    <span>Chat por Texto</span>
                </a>
                
            </nav>
            
            <!-- Voice Status -->
            <div class="voice-status-card">
                <div class="status-indicator">
                    <div class="status-dot" id="voiceStatusDot"></div>
                    <span id="voiceStatusText">Listo para escuchar</span>
                </div>
                <div class="status-description">Sistema de voz activo</div>
            </div>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- AI Face Container -->
        <div class="ai-face-container">
            <canvas id="faceCanvas"></canvas>
            
            <!-- Face Features Overlay -->
            <div class="face-features">
                <!-- Eyes -->
                <div class="eye left-eye">
                    <div class="pupil"></div>
                </div>
                <div class="eye right-eye">
                    <div class="pupil"></div>
                </div>
                
                <!-- Mouth -->
                <div class="mouth" id="aiMouth">
                    <div class="mouth-inner"></div>
                </div>
                
                <!-- Status Text -->
                <div class="ai-status" id="aiStatus">
                    Hola, soy tu asistente de IA por voz
                </div>
            </div>
        </div>
        
        <!-- Input Section -->
        <div class="input-section">
            <div class="input-container">
                <input 
                    type="text" 
                    id="voiceInput" 
                    placeholder="Escribe tu mensaje o habla con el asistente..."
                    class="voice-input"
                />
                <button class="voice-btn" id="voiceBtn" title="Activar micrófono">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="send-btn" id="sendBtn" title="Enviar mensaje">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <!-- Voice Controls -->
            <div class="voice-controls">
                <button class="control-btn" id="muteBtn" title="Silenciar">
                    <i class="fas fa-volume-up"></i>
                </button>
                <div class="volume-slider">
                    <input type="range" id="volumeRange" min="0" max="100" value="80">
                </div>
                <button class="control-btn" id="settingsBtn" title="Configuración de voz">
                    <i class="fas fa-sliders-h"></i>
                </button>
            </div>
        </div>
    </main>
    
    <!-- Shaders for Face Animation -->
    <script id="faceVertexShader" type="x-shader/x-vertex">
        attribute vec4 vPosition;
        void main() {
            gl_Position = vPosition;
        }
    </script>
    
    <script id="faceFragmentShader" type="x-shader/x-fragment">
        #ifdef GL_ES
        precision mediump float;
        #endif
        
        uniform float time;
        uniform vec2 mouse;
        uniform vec2 resolution;
        uniform float speaking;
        uniform float energy;
        
        float hash(float v) {
            return smoothstep(0.1, 0.9, abs(sin(v))) * 10.0;
        }
        
        float circle(vec2 p, float r) {
            return 1.0 - smoothstep(r - 0.1, r + 0.1, length(p));
        }
        
        void main() {
            vec2 uv = gl_FragCoord.xy / resolution.xy;
            vec2 p = (uv - 0.5) * 2.0;
            p.x *= resolution.x / resolution.y;
            
            // Base face shape
            float face = circle(p, 0.8);
            
            // Dynamic energy waves
            float wave1 = sin(time * 3.0 + p.x * 10.0) * 0.1 * energy;
            float wave2 = cos(time * 4.0 + p.y * 8.0) * 0.1 * energy;
            
            // Color based on speaking state
            vec3 baseColor = vec3(0.1, 0.2, 0.4);
            vec3 speakingColor = vec3(0.0, 0.8, 0.6);
            vec3 color = mix(baseColor, speakingColor, speaking);
            
            // Add energy patterns
            color += vec3(0.2, 0.4, 0.8) * (wave1 + wave2) * face;
            
            // Mouse interaction
            float mouseEffect = 1.0 / (length(p - (mouse - 0.5) * 2.0) + 1.0);
            color += vec3(0.1, 0.3, 0.5) * mouseEffect * 0.3;
            
            gl_FragColor = vec4(color * face, face * 0.8);
        }
    </script>
    
    <script src="{% static 'js/secret/secret_voice.js' %}"></script>
</body>
</html>