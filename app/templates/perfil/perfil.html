{% extends 'base.html' %}
{% load static %}

{% block title %}Mi Perfil - De Rabona{% endblock %}

{% block extra_css %}
<link href="{% static 'css/perfil/perfil_styles.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- Profile Hero Section -->
    <section class="profile-hero-section">
        <div class="profile-hero-content">
            <!-- Profile Cover -->
            <div class="profile-cover">
                <img src="{% if user.banner_perfil %}{{ user.banner_perfil.url }}{% else %}{% static 'images/banner_default.png' %}{% endif %}" 
                     alt="Banner del perfil" class="profile-cover-image">
                <div class="profile-cover-overlay"></div>
            </div>
            
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-avatar-section">
                    <div class="profile-avatar-wrapper">
                        <img src="{% if user.imagen_perfil %}{{ user.imagen_perfil.url }}{% else %}{% static '/images/avatar_default.png' %}{% endif %}" 
                             alt="Avatar de {{ user.nombre }}" class="profile-avatar">
                        <div class="profile-avatar-ring"></div>
                    </div>
                    
                    <div class="profile-info">
                        <h1 class="profile-name">{{ user.nombre|default:"Nombre no especificado" }}</h1>
                        <div class="profile-meta">
                            {% if user.posicion %}
                                <span class="profile-badge">
                                    <i class="fas fa-futbol"></i>
                                    {{ user.get_posicion_display }}
                                </span>
                            {% endif %}
                            {% if user.ubicacion %}
                                <span class="profile-badge">
                                    <i class="fas fa-map-marker-alt"></i>
                                    {{ user.ubicacion }}
                                </span>
                            {% endif %}
                            <span class="profile-badge profile-elo">
                                <i class="fas fa-star"></i>
                                ELO {{ user.calificacion|floatformat:0 }}
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-actions">
                    <a href="{% url 'update_profile' %}" class="btn-profile-edit">
                        <i class="fas fa-edit"></i>
                        <span>Editar perfil</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Navigation -->
    <section class="profile-nav-section">
        <nav class="profile-nav">
            <button class="profile-nav-item active" data-tab="info">
                <i class="fas fa-info-circle"></i>
                <span>Información</span>
            </button>
            <button class="profile-nav-item" data-tab="stats">
                <i class="fas fa-chart-bar"></i>
                <span>Estadísticas</span>
            </button>
            <button class="profile-nav-item" data-tab="elo-history">
                <i class="fas fa-trophy"></i>
                <span>Historial ELO</span>
            </button>
            <button class="profile-nav-item" data-tab="teams">
                <i class="fas fa-users"></i>
                <span>Mis Equipos</span>
            </button>
        </nav>
    </section>

    <!-- Profile Content -->
    <section class="profile-content-section">
        <!-- Info Tab -->
        <div class="profile-tab-content active" id="info-tab">
            <div class="content-card">
                <div class="card-header">
                    <div class="header-content">
                        <h3 class="card-title">
                            <i class="fas fa-user"></i>
                            Información Personal
                        </h3>
                        <span class="card-subtitle">Datos de tu perfil</span>
                    </div>
                    <a href="{% url 'update_profile' %}" class="header-action">
                        <i class="fas fa-edit"></i>
                        Editar
                    </a>
                </div>
                
                <div class="card-body">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-user"></i>
                                Nombre completo
                            </div>
                            <div class="info-value">{{ user.nombre|default:"No especificado" }}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-envelope"></i>
                                Email
                            </div>
                            <div class="info-value">{{ user.username }}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-calendar"></i>
                                Fecha de nacimiento
                            </div>
                            <div class="info-value">{{ user.fecha_nacimiento|date:"d/m/Y"|default:"No especificada" }}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-venus-mars"></i>
                                Género
                            </div>
                            <div class="info-value">{{ user.get_genero_display|default:"No especificado" }}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-futbol"></i>
                                Posición preferida
                            </div>
                            <div class="info-value">{{ user.get_posicion_display|default:"No especificada" }}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-map-marker-alt"></i>
                                Ubicación
                            </div>
                            <div class="info-value">{{ user.ubicacion|default:"No especificada" }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Tab -->
        <div class="profile-tab-content" id="stats-tab">
            <div class="content-card">
                <div class="card-header">
                    <div class="header-content">
                        <h3 class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Estadísticas de Juego
                        </h3>
                        <span class="card-subtitle">Tu rendimiento en números</span>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- Stats Overview -->
                    <div class="stats-overview">
                        <div class="stat-card primary">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">{{ user.calificacion|floatformat:0 }}</div>
                                <div class="stat-label">ELO Actual</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-futbol"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">{{ user.partidos_jugados|default:0 }}</div>
                                <div class="stat-label">Partidos</div>
                            </div>
                        </div>
                        
                        <div class="stat-card success">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">{{ user.victorias|default:0 }}</div>
                                <div class="stat-label">Victorias</div>
                            </div>
                        </div>
                        
                        <div class="stat-card neutral">
                            <div class="stat-icon">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">{{ user.empates|default:0 }}</div>
                                <div class="stat-label">Empates</div>
                            </div>
                        </div>
                        
                        <div class="stat-card danger">
                            <div class="stat-icon">
                                <i class="fas fa-times"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">{{ user.derrotas|default:0 }}</div>
                                <div class="stat-label">Derrotas</div>
                            </div>
                        </div>
                        
                        {% with total_partidos=user.partidos_jugados|default:0 %}
                        <div class="stat-card accent">
                            <div class="stat-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-content">
                                {% if total_partidos > 0 %}
                                    <div class="stat-number">{% widthratio user.victorias total_partidos 100 %}%</div>
                                {% else %}
                                    <div class="stat-number">N/A</div>
                                {% endif %}
                                <div class="stat-label">% Victoria</div>
                            </div>
                        </div>
                        {% endwith %}
                    </div>
                    
                    <!-- Performance Chart -->
                    {% with total_partidos=user.partidos_jugados|default:0 %}
                    {% if total_partidos > 0 %}
                    <div class="performance-chart">
                        <h4 class="chart-title">Distribución de Resultados</h4>
                        <div class="chart-bars">
                            <div class="chart-bar">
                                <div class="bar-header">
                                    <span class="bar-label">Victorias</span>
                                    <span class="bar-percentage">{% widthratio user.victorias total_partidos 100 %}%</span>
                                </div>
                                <div class="bar-track">
                                    <div class="bar-fill success" style="width: {% widthratio user.victorias total_partidos 100 %}%"></div>
                                </div>
                            </div>
                            
                            <div class="chart-bar">
                                <div class="bar-header">
                                    <span class="bar-label">Empates</span>
                                    <span class="bar-percentage">{% widthratio user.empates total_partidos 100 %}%</span>
                                </div>
                                <div class="bar-track">
                                    <div class="bar-fill neutral" style="width: {% widthratio user.empates total_partidos 100 %}%"></div>
                                </div>
                            </div>
                            
                            <div class="chart-bar">
                                <div class="bar-header">
                                    <span class="bar-label">Derrotas</span>
                                    <span class="bar-percentage">{% widthratio user.derrotas total_partidos 100 %}%</span>
                                </div>
                                <div class="bar-track">
                                    <div class="bar-fill danger" style="width: {% widthratio user.derrotas total_partidos 100 %}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>

        <!-- ELO History Tab -->
        <div class="profile-tab-content" id="elo-history-tab">
            <div class="content-card">
                <div class="card-header">
                    <div class="header-content">
                        <h3 class="card-title">
                            <i class="fas fa-trophy"></i>
                            Historial ELO
                        </h3>
                        <span class="card-subtitle">Evolución de tu calificación</span>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h4 class="empty-title">Próximamente</h4>
                        <p class="empty-desc">Gráfico de evolución de tu ELO y listado de cambios por partido.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teams Tab -->
        <div class="profile-tab-content" id="teams-tab">
            <div class="content-card">
                <div class="card-header">
                    <div class="header-content">
                        <h3 class="card-title">
                            <i class="fas fa-users"></i>
                            Mis Equipos
                        </h3>
                        <span class="card-subtitle">Equipos donde participas</span>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h4 class="empty-title">Próximamente</h4>
                        <p class="empty-desc">Listado de equipos a los que perteneces y tu rol en cada uno.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab functionality
    const tabButtons = document.querySelectorAll('.profile-nav-item');
    const tabContents = document.querySelectorAll('.profile-tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // Remove active class from all buttons and contents
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked button and corresponding content
            this.classList.add('active');
            document.getElementById(targetTab + '-tab').classList.add('active');
            
            // Animate tab content
            const targetContent = document.getElementById(targetTab + '-tab');
            targetContent.style.opacity = '0';
            targetContent.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                targetContent.style.transition = 'all 0.4s ease';
                targetContent.style.opacity = '1';
                targetContent.style.transform = 'translateY(0)';
            }, 50);
        });
    });
    
    // Smooth scroll on profile navigation
    const profileNav = document.querySelector('.profile-nav-section');
    const profileNavOffset = profileNav.offsetTop;
    
    window.addEventListener('scroll', function() {
        if (window.pageYOffset >= profileNavOffset) {
            profileNav.classList.add('sticky');
        } else {
            profileNav.classList.remove('sticky');
        }
    });
    
    // Animate stats on scroll
    const statsObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-in');
                statsObserver.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });
    
    document.querySelectorAll('.stat-card').forEach(card => {
        statsObserver.observe(card);
    });
});
</script>
{% endblock %}